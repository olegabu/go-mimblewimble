package ledger

import (
	"encoding/json"
	"fmt"
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestValidateTransaction(t *testing.T) {
	bytes := []byte(`{"offset":"d64985871c59d84d2a32bcfe5cda78d6c8558f219a3e86729215b18976487773","body":{"inputs":[{"features":"Coinbase","commit":"08acbca8aacaf953615fca87cf0751b1742b48326d1a39708daea2ec839114f49d","asset_commit":"0a9996ebffb20a0ab5f86cda1850c4d24af621c4ab18798ba68e85a4f72be7b705"},{"features":"Coinbase","commit":"0856bdbdaa0efb9ad36c6e32c69867bba673a5e7239b10214a2cd4f823305d0e44","asset_commit":"0b2a03f7b75304e45b51fb63bdfc13b43a7dfdccc70f603050e733dc7377476e58"},{"features":"Coinbase","commit":"08faf2c142085ddd4e02209ae7379944b59f8ef7fff75181264ea75f611b613eef","asset_commit":"0aad82caf31037ee9ed7ee1154fb9a5cffffccbe1d59b6f4566b95efb2dfbd7e77"},{"features":"Coinbase","commit":"099096732585df405d0813c154fc7544eeda67dbb9baa5ed85a5d52c6387b588c6","asset_commit":"0a443aaea3ec5ed0c6f0c21c827fc4770dcf3d5072f2c0967fa111de1b1b17d2a5"}],"outputs":[{"features":"Plain","commit":"08d8cfd8540cd8c1216ca7771a6d51e4839bc862cdca14a0a5139336b25d6021fa","asset_commit":"0b29aba349e98bda84cf5c66af10b38e2ccedb578ed8b861c383bc1c873ee21cca","proof":"2bbaa008b08b7896e646b1ff0b284441202506b0945bf5c6f5ea324b5b80e48309c781b2ca6a1d05a389d38bcb1503b651ce2a52f2e4e2ed4406f15076f91d760bf9d67a48404d0d710e0affe09398cba69b379d2e4df70217f66948586ed06744908131e952cd0c876c6702a13f174a74a7726d3eb98d4478ca5662188f85fd60042824123ea3e2a8f2eb61e11f55399b4d493154951e9ccb63e4363ca4da146386eb883b6048654e42bee5c0185c37afe73b2719ab8dc15094b5f3d586bbb08b6c980cf73b99618775a6720fc86ad5955fde80697d9b182cb7fcc189f0ee8d8f10dfe14c8f46a89e9a5f5538ae8e68f8bab4793cee13529b1e8427bbaffe6da5e4d1c7d968efc9a7787a94267475521f84079f1cdb9d23f35bb54c6d846fcaa3d76a84d0f11c71d7137021adf4d83859a01f15ca283fd551446bb0d4030bd75b7b938d46a111e400a1af2e972944404a610dc5754248414575547df0fb38736beb0140b491cfd288e99f073ca5adb37bb2dc11e6e8f5af1c73613fb5cf1273c70bfad5bb36f55ff35fe7680f08a6058ed88ed91ec55e6e262c2787fa8b33897ffd7b13351d9622af97d66aaddd73437167c8be358d0e24a5a2e20d0e0ba3b8b407e07441433f7fc05926b60875ce67bf065ef883d39ffbc8738a57f9110d08988b39b571ab6fcfb21931fa4e0b77ccad73e12152d1d5dc241972bcd8b1fd4998ec2125c5ece1b73cacaa2c1cd4efc27fc155be2fddcbe99d70ee7818ee89a8b68f23762e167a612d5ca4698a9ff64faaaf97a327700b008103c36c4d425425089d7d350081788dfc44193fcc4a56e0a17e997a7cb54f1a1608365574ca3d61a633cc515f1040a0ef6e6c670594842e530b22b848680ab7f00a400ebb9ead53617a6beb80a1990b6998baf29e4e8c26e20f197ae0be5dcb0bbb18e1429af297869a9e","asset_proof":"04000ff034b2ad16a853c06f8775e7a892ce2d0251c763722aef1cf607ca0ed8b0b57c647367922163d66765fbad908aa7b79d214cb2346ab84657965573c5201932d5f2735242f01016fe2c9e28c9242ee7ab6a4772ff9c3203e80c76aca28b2d53a69f81b21f32e55cd17bba915298344035b6fc1c5759f896bec9a3f71b10fedd35f3059e922f432e1d531f9d4a0dcb46794f2885e3cb03e3d1a92e5a659608e1d9"},{"features":"Plain","commit":"097b70bedc7913dbd36e9d882f16bf3fdf56ca88f9d803c1c383aab2d5d438471e","asset_commit":"0bbddd67f6a3bd28726b1d53a97abe435de175c11df3431483a689161bd2ff9c60","proof":"a561168982f7fb93cced259f332aa86048e16fa076baa8e304748e8e0c732a3df5056f39cbc8211e0c7a7733887c1a00f9116233aa4e72fa5f97e1f14fda0fdc0492b10aaa7c2363a6b42b853443fd2ba95d7a5e46642a72ec4f4ca3e70f719e5c65506fedd2441ff00136cceebb8b2397b9c59d9a270d264caa121e88c811f1ac4f91c73d2e90a2e25855185b47a7e37fd2b04d5b98df72af4fbb17bb5b8cb2ff1efd69608ae5f8b26ca0e7e4aa0d9bedd60708292d5415fd4c31e746eb98c6e2e8120a8bda12f4be66de6c486bdec952d85fac94a88d9031cfc73eb019d3f71c0a863515fc864586f715b8ca294314b471371e32e8facd8cd71c555aef11fdd62f6c02cf72b7cda434c97227c394085b34d6d9fe5bced976e6ab5eeb7bc1c5dadd28d52bee55dc13c65b33aa0b48c8d59e8c7163a9f0a9a2706b17d11deaaed021eeb5acdd45066425da890d3c3faed65eec2a8146df864ff88ac5ea54a5e5aa0103fac1b51f9c446dc16975b051ede9af2acc5ad232f1ffe8037b8b0e59c70c3dfbc9d71768e89c5ceecc7086bbc9bec19dcdd73d4a858dbc404ece8ef50a23e04826467e115a128aff7fe292d98332be2d4ce0d4a496b32302b37a1acb2f02981ced4b6f0ef6403e4cd1b1ad033bc877106dbffd2773d1028e48b3bfae13e90e5d1d69afeaf4ce8862e064f6cc9a3067235f44932d31e06ca237ee04319b1c576e24345545c628e19527c0f2eccc69d2789fe075adda26fbb1044651c365b9647a6d7cd6174c407cd949394cd0da0fae1ee8b370110aeb168046b4bcdbc9d103113a2e27c6256f2cffe57f38aac2fcdeb355ca27f9d6cdda3f32468905c89afdaa01bd0fa30cb311a0dbff0eca08899948f50f0c11e61399b2332c33849251fd437a1d205af41bb09f6645d63451d31db7f246a84840dff7dc609b87ec567a72bf","asset_proof":"04000f298906740b9819b16e5555d6d155bdb76a0cb40762e90642c63c89a59a13039aef0e78e0902c71d44119625983a7497a2939f7ef86555faef67cb7e64c7a0589719f306d0d20e49179993b85d24321b609afef4459d0d747a6f396e31d8a8df0a028e1abeb2f1019b6eaddabb697e325af64ec6dfa15d09b1a06a554fa1bb60abe8fd8a6f5e1b568e91bc43949e27925b9ee27be5f0145754f680423dbcec8f1"}],"kernels":[{"features":"Plain","fee":"0","lock_height":"0","excess":"08dcac2abd0dde9cad437a9cdd69ff69e97688133d7082c104c8bfef87812f67c7","excess_sig":"d38028578b67c80bd5f87939e38ec6b702c9bc30142dfd28bad32cb4feb47aad788d200e4c045109f4fe426edd320a3a695842d57d65311b76aecf25a24c447d"}]},"id":"3e010131-5989-415b-aea7-91e226e2743e"}`)

	var tx *Transaction
	err := json.Unmarshal(bytes, &tx)
	assert.NoError(t, err)

	err = ValidateTransaction(tx)
	assert.NoError(t, err)
}

func TestIssue(t *testing.T) {
	bytes := []byte(`
{
  "output":{
    "features":"Coinbase",
    "commit":"09a55256283c7e470c64a989aaed2542b11bc9cbe5bc581b7d2851638c5f82c6d8",
    "proof":"d359b542447268e71d7bc0ed5bbb9fed0f89db4f247c29c4c0e3189c6b4d8d944d53044b8b4101eda13534b90e867f61d7ce0a6fffbf1aaff68fdfa62e7487e5037828048e55e0e5a8226b1cc756c6f2347023460e6028023c1441ff7fb02ce013ba95b45a50e8f46e85e8286fb02e1aa3b00729676e5df976322c782ce8832bf89c29c2daaaefe02222d10f661d27b716853e1d2faa4c946787e9e98ccf3b1b4fd16dd843370571cd4170057c6a9a4be106ff9802ebe0fad01bc55b4e869347886d9aa3336a0e6bc41ea065ebe0d89da70242ed96774069c5abc0c7c65bdf8e1b3edf773f4fc8448eb60febb3645c7f5c3822b6f9baee022869773d2509cb2005088e6fa75250d57948430ab04028cc418cf76e2821180b2c28e38e8dbc0bfcb1362393fc388343475951ffdd6ec0112eb2bf8b5735bdd23c769fd01b93abdc831270d6ad3f7bfe64a9f07a72b5f524b9f4a737f0de640bf6c21d4baf2b9c0d0304028d3e4936446466d9b96a814248cea58e811f5f4a0f2c2d9f6bd4a91d461f80bc6033d19c678885a83653d2fbb5b781f38db70aa88712ba3c95c88bcd5d9c8da1b1e902fd89bcc1ed6b85c681c6418bd7e6f45086c5fcb3701fc0de844b2148feb8ca84889b512275fe80c9aec59d3082b69e2e3589a6ccc77cfcb3dc86f56b234df50950ab9264884117243372e66ab56aca1872ff22fcf7a4c81555d320e8698e3a5417fa88a60ccac698d0f685852f0421173bde8bd139c5904e61b7bc3db7f85fd0293b1a1c74d48b2069cfacec74bf3fd1bf7bd2c3f688dfca9e95a23f4eedf7a777e12b1b1b49dc63f98b3e58e289b34d5ee4b55868e40a5ff27ce0393c5213e575fd7093f86d127a679adb05980cba0ed679f0f4406dc23bb54163a3efd6dfe77ad27617e178e7041283cd605e80966bfa6ddb7fb0ac089eb8cf1675b9",
    "asset_commit":"0b491c9639db5d37d4fe39f09c0b482ce9fe384171a2342da5a75bc3693becbd66",
    "surjection_proof":""
  },
  "value":3,
  "asset":"¤",
  "kernel":{
    "features":"Coinbase",
    "fee":"0",
    "lock_height":"0",
    "excess":"08c63f8b6ff523b445c793af439845b232a5142451778f31ba9174a0174f6f062b",
    "excess_sig":""
  }
}
`)

	ledgerIssue, err := ValidateIssueBytes(bytes)
	assert.NoError(t, err)
	assert.NotNil(t, ledgerIssue)
}

func TestIssueInvalidBulletProof(t *testing.T) {
	bytes := []byte(`{
  "output": {
    "features": "Coinbase",
    "commit": "0980596ec61a13a445d49ab6b9a14bbe29d88827a723aeeac12d1ee0b3ed4a1882",
    "proof": "deadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeaddeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefde",
	"asset_commit":"0b491c9639db5d37d4fe39f09c0b482ce9fe384171a2342da5a75bc3693becbd66"
  },
  "value": 1,
  "asset": "¤",
  "kernel": {
    "features": "Coinbase",
    "fee": "0",
    "lock_height": "0",
    "excess": "08764a0c0d67bc674b958d756642aa5ba2b2371d4eae6bea22debe9a2ea62844e6",
    "excess_sig": ""
  }
}`)

	ledgerIssue, err := ValidateIssueBytes(bytes)
	assert.Error(t, err)
	assert.NotNil(t, ledgerIssue)
}

func TestIssueInvalidCommit(t *testing.T) {
	bytes := []byte(`{
  "output": {
    "features": "Coinbase",
    "commit": "deadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefde",
    "proof": "086b8dcf66ddfbcaa93513e795c1e2882a75d614d78312252a5cbd83fb436e563b35cc2615c7905857b58e604529f3f76b4dc1e56b2658fa82d79e6f4a961e26038a6987f949d7982e732ec4f53762a6c83dc1feb3b41839386d30d6776907938af7dbf52c0f0f54979f877735eff39a07e3463e201be8c8cf35849ad744e1d2bb7417ca9e5836e3bf36d94258ba03bd7a478fd18fa6ee7820f11e5c43c23b2d18d217307b09a05441a6daa75aaf185781f73532b73afe7a332d14938d84021ef5a6aedec66042ea5ee8350164877a50c93307c9d9b1aae7975cffd65d79d48ae4bd9a1105dfe9b19b3754dbfc63a8081dc22d78b5b9153f041001c83b95a65d141205b045e44b9308e2120ebbf9a11b29c335c57046c514c969fd13dab9a791d9e6292ae1c3f4c52afc5a3f5c7b2d077479047a52631388f34bc6bac65f2bfa95a7823e5e53fc4f514eaeb1020d15619267ec05349fa7c03706fc26604b913c6efe02725a98a32f477213b8855693552b313305e5cce1aad3ec2e63d594320597666eae21d51649b97e501a3062c8fd152e087fc2d59a2a583b7d9c6e7ed7ef4eab5e08e7b956c41653471ae5f2baf19c1f0107312e0e7d4c4a5e7e48ab293f2f860a484c913414f4ffe4d06626a515b2460a17cb3c19c6bd6d81b8d31664fccc342649399001387f3997ef8614eee5e7f45ee159e8eafe5256f132d94adca2ee99b46afc950792687b8812b2628d37679dc09782962694ec91d692b8414493c8f432983d7070baaa48d937a96ef750d8ba0654be7bb5e46c1bd0e2c622ec97f8cefe382acdd920af52f9ce53f375b5c4a0334cdfbfb948610fa1c435b3abccfb23f614db476723a6e78512c1ea459bb82869d92d4407f8f8561675fb1af571286f849b524d9874dfb366154d164f7089c33cd7c253fc8dd43ae68f407cb0730cac6a",
	"asset_commit":"0b491c9639db5d37d4fe39f09c0b482ce9fe384171a2342da5a75bc3693becbd66"
  },
  "value": 1,
  "asset": "¤",
  "kernel": {
    "features": "Coinbase",
    "fee": "0",
    "lock_height": "0",
    "excess": "08764a0c0d67bc674b958d756642aa5ba2b2371d4eae6bea22debe9a2ea62844e6",
    "excess_sig": ""
  }
}`)

	ledgerIssue, err := ValidateIssueBytes(bytes)
	assert.Error(t, err)
	assert.NotNil(t, ledgerIssue)
}

func TestValidateState(t *testing.T) {
	outputBytes := []byte(`
[{"features":"Plain","commit":"08585fc9badfb18e46ffb53f4600a7d9872441c743df69f421531c79d0f6710d6e","proof":"1837320810e4c46f7e885a0ab8f21ba22799cedf5bfeb03db620deb3ee3861a9af4b2cc19c8d1bc8cd05fae22a92381f3d2a6c184a51b5f7b8fe4867d58f1bae08271fd26bf7897d57796a32c278692fb9dc7ab075a8cca69dc63202b8815ef421e2c395e8bef137aea904e6b963ce9d95565c6c20f61483b0a4466a14bbaf4f88063828e9486d5fab261e33e079e0af225b3a72349ae469f78eadb32829454ed51cccb4a5e7f95bc6333201565d0aba32756b386005aaf9a63757e459418b4ac14477daa1ba9b37fccd67030b809d007b4c76c636dfbbaa434e6854e127ee3f3b3a4551dd28e79423673df0310847246d470a0dd91a607eedf23e83212c76cfe8604ea7e19eaf5e95de0e6112f7f01b682b139402ffa825eb9e2c89356e40259c067f9ee90ea208f5466cce704270a9ec1459d200b37d8e05db020e605a0e13824aa0bd4ba31afc77364a289a849ae302c6a4fb37daa0d94607f141a6aae871469e023691b139e675ee85a0e986ef33aa507e9b1fdcd3926dea663a98096e200c92f87d744e37eb5e104aaf9167c403a652c65404aeb55ae3aa350b00f15335ba39350d87849179fc666dfc6cfda00473eb7e8c9bada3108c8894e527e5369c44efbb341c794011704c6eaa89eec0cdfbfecc8e10af3c7b541c0f71ddf54ce6cdc2512b676f94a347fb37c95df292bdc1dec1b1b251ac20f3ec2c8059e57e6419f48bf29c5e24c366bf3c29f27637a3d66d97ec9304635995cab9c1df5f5d31fdd8cc41996a17ebe8387d8ddcfeeff65ade8849fedf5dad5655fc3a99eccfc8443e6c37a29e520faae8f0eb4c471ba04e91f2abf1ecc6c5ce7f7c82e64a73c8a57fc88d012346882089e374641692d30027629a84ac389e481f6fa5654462b2e25f6dd6b38eb8fe960bcc013f141efb3b4a1798292735337c0d6980a4348debe8c817","asset_commit":"0a469f116c8b0df1ac3dca7759e7181e1dba4e199fe659cbd06aa1626a29abadc3","surjection_proof":""},{"features":"Plain","commit":"087b40e984177877a34e7d8f7d4cd2e0aecac3b880d2d2e8fdefb1979db7385ba7","proof":"8c5d70f07f6d40eee824f305465700b6a7c4274d72c78bad93166f9d64e994fa6918c6a573dd0e09c3dcb4401572face1f9c90d9b171568b245d5691a0c802ec0e29172ef1d65248a213adb3284f647c06ee3afc241513b92edfaf4a90df856f5a31616a851cfddc5f736fa5283edf9935971dcad3bb929f93c565e3b9a694a730d055a04ac29d419d1fbe8e1d4572fe7b175361156ee76d9b84dcc6e16798f52e0864937e8c816c8ad2df8a890ddab9aa85ee1897c10e8f4aa004d0e8b27706dc0664bfcc3ff50f1dda8b8d0296574594c8d6aaa67dfc4e1edbf5acdf2e34d5f2cde74bc7f3008b664e78f536939b20515aca15244f9ddd8e75ba2704a1792f26b69b6e353cdf8df2cecc91db45258ad7863ffb3e8a9aa8f39912756c98907921592658c53be1dbaea510f3d1658f84dd4df1c9baeb29e386f44c98b6a0624ab981773dce84c2bcd7e11a6226023869475ac9b64e4b650f5d4db9e5ab751310bfd80174d88eac4cf5fba1b3f1e3c7f72ae0e349e50567966cf526e2c772ea1b2ef51a7042815d1c50a447cf7abf2f988ae6678a3dedca752ffff069aba91f5842f69430c839153ab36a7172a13eeb1313868976b5161074dc30931ce6436cb80cad7771fa5502ae84f98cd0bf3bc72f4947de119120bcc9aecfc31d4bb1bbaa71feee1c1d2048bd00a7ada7521c20d7c0ca8cd6686cd84cc2f50b2349a20824607f8f9102637ce693ed833182a8a3d29cfab428fc427d6641e68bda76d27faba9183639a28e5ed3acd9a09900079be08e275e1212911d59561c710764ccedf1bebcac7177609ff2efebfc1a84793e4e56fd042419743809665af8b1d1d4ec2fd7756602a5698a550d0ba0ef7d2783a941f50a4b57e77a79195e510d64b13b11d7a19aa9cf37613ccb8703116448d85dc924d3821c33d0545004f7d137d28eedfd553d","asset_commit":"0b78fc196fd84d3bcb5b8aba40a3f0755a8cf40ae6b6a69cf2c952e58f827fb1fe","surjection_proof":""},{"features":"Plain","commit":"088e0650bf4f58f745b48a4a93807e1b748a049faa00cfe3315601dd883820c97a","proof":"b8d940ca0969cce6ada72b0ff08e2ec8e524cc869335a8675f5efaf7f23b9673798c6a128aea23fc1b87d921ffb983ab45690e4042787c3256496560ffa2723b0b3f7903c68bd2b8902c2b4d767cce4728e3c5b323e4f27972e6c8731312e288de3bb71799c2dd4127e51641210b55c40aba9cc59320675817a80747356602734294a6de1dbb987b8d4bce557f1a608b099b932efd60f42d8b1dbec211182fcfbbbb34a4ef3a67ea183e7f1f5f0774c45ae111d6a3bbe77f93b92bc54249380832d39aaec43c5034548c824d2e9fe21e597ca4df551687623b4e8407f1264dd9844c8243b08f1953419950dde87b57c855d85d1f0b904c15ab699a93fc725badfb6fb0aaa4109db0b76c27c09bd246965e8baa2498cbacdc9fdc72146e1ba8f27dbef9d6a1b6d232005cd494ac273c493d0678581ed8d2391cb73544334652c55f0d536ea2e6f312c3352ef56ca2a55ff63ef936f9f00474248efe01c37f53a7265a03961ced6a6dcffd9de902c821e8fee92421d7b44a517291e70b0f7ed6259c44b0153f06d7718236b6f9683408672d3299bb140ff3f713fd09fdf1a0139ebf46ef6355c7060a828e8cf07971211d4da304e2a2248e2e91c4d2a995d2a47b28897af94705b96c33cad38d95198e27eccd5974fc0532842128396790d18e4f99796a6467828c0a7ace4e3d9caf2585c1f3cda0fc3f7808b07d4efc5b1b4148814ece684a1272b4dfed3226922e1dc6a4a1bc63fd6df346db4d0b5eddf0b1b9143c834b32db61d28e1661a0980920470f75bc6c455fa487c7b19fa4deb97c48bc3f77a508eaa48cc9cecb1ab9eadf2a9cbd378a4d0c2c5244350f91f794d90f954f5e5b02c24751ef4a8f35b603d9c337085146d9caee59b7d8b9d84eb8f73e330a0d768f9663a44c7df3d785cc6706dde0d6164361d0521ddfcd1d7107694e9bc69f","asset_commit":"0a545a70b2130efd49a0f63b2f8213b3158e1df9cd579b5bb83ae317bebd7ee0be","surjection_proof":""},{"features":"Plain","commit":"08b2c1bc443ba0c4a7fce78e94d81b340a4f3426a58aacfdc65649a475c1852c5c","proof":"a5dc729372d35321faa5dcf122ec86d6997bba34601f541e4a0dcc93add076497f0d97bec15d624b6863fbcb72754b3da3fe4b2e446ce2f6ea175c58855e9a480aa55bcb53abacfb2a2d53b21c46f38b0543483c279360ca2bd1c11fe1bda7c442da852a9fb915999459dc4c9ca7d79e53f4ec35a0c9c81bde1e425199cd01638cbd0e954043c0ab75cd7669e11d4a6740e299b3f52c29dfd669bc58b1b74b0c7292ef237f4b73598165763faba32f5ea359920da16b939ec40cacf924ce44172f0c116c41f9e7e9ca639b190f64c37af1fa77fba1a5f414babbd725d35ce003465e4ab2eaaac219807e3f8daee685b072d2af5d27cb2d962d1475aed02a2b6303cb592bae8129f420d689bcaef49ec220cd8e080d11cfbc600adf260a03352a98af34e00e7b0b8fbb3f4bb21491da3b425eaeae37846af316d058f1b3d373d1acf735117306f7c58f1f46255c7779fbf6a406571af69a12d1b98704426a99ab8e06016ce33bc27a84407e732b46af7d4ed7b9ef505082e7b6e1b63160802b288a2aef0ae6f2c0399e33b17266bdfb0e39a3b5ea1524f513b62bfc57e4917cd70dc66079cee98c72ea3d54d5944164d7fb1cd92f854523225a8b0638759af36dd75a23ca7642acc9fb3e91c1ee3421177e0ee6b7795ea4ecfdbc2a062cb6bf2d18cf26c827f8cd73941273f5c9929740b716522aba9014e7a16e6c32baccad5939c9426e9ea9e620a15e7c71573d4a48ffb847ea1e59747e4b9118da58bae1c08fbd817b8145506b3995bc93d8a2b9b3632544b38f3fe243c5dcfa91d7b557b6af2f19010ac71f5841b570816083a49c2f1784d21ae9de853fe2d7e82c9f4950c4bf8222b2c90ad93acccd9de961e48a05a4a97a7dead6dc9a0497475a3f543c49037c5dde54870f1e8b67f66aebe2447c3b9202a553822d4751ba2b101a8aed8b4565","asset_commit":"0ad5adf475e147625992e9ef6378201921c979f97524933dea2faafd76eda81fe4","surjection_proof":""},{"features":"Coinbase","commit":"094c94cdf9863e4c4625b82beadbe136b6c9badaa0da0e67e6c75ae18c0970cf9b","proof":"7b850ae6f26f67d6136cc56e4f89306f01f829c14b51bd79c3f63929ab94501dc42d13a6361430ff60cb313314b901e64f44d620969b7c5cf098a3ef0b43184a030244b07edf40df1d9b7807d7a4878f22726ef740840a82378ce304f309d110782efe16c33a01e2e0c975132c41d828fde6c3a50cb15a10d52698359206fd48c2c5c415969a3558658a7bb6a8a1aae4332bb373e3378d6ffb9ac885e2781270461f0105f953af3b0e93872cc5209591561901c6a605d67a4fd379501953f569eb6a3f8ca1c7f43673c2de4aa9e9bbe0bcb3e4ab6212cc73043ab39d423d40fcfb04e833f1ba1ea6930b21ec42bda0ed66f28742517d51bc73f3ac141cbb32769fd4671cab8c3f6e532595340f1d20edb527567f6d66fcf06d48ac8cfa2a98b0f6b2519aedbd4267f02e4fd93b7d7a36ffa9cfb48970b71e154b823a18656cd1486686d08d6a608d46c8478598fdef821bd6ec3d140144c9c329ab6316302666ed0202aa27ce1ae8773471d490487e37da9cbc0525ba0b23dfdd1af4832baf62af76e83f7a2123cffc8c677dccc6f987e6efd8a84156b60813fc898fa5467d44c424eddb932f5137af408367ae2e7007fe86901c419ba2f29b6282bcac84b96667cf3b81c96bfaf16ba20ada36a9a3dc30d16cd72e52dac9adacbf7351725f029d63c94eb99842833e533c9a6d122306157238b908f46dba32ffaf8f24d74b64ace34f43ac2f72a65a436b1fe7d3f50508463ad28e67ec06075950c2993b86a297ab3da8fec79b8992fb9fcddac98234571d7f853ba322b319caeab5662ea602f0dcb7de35afd2426e611ba49ffd32ed6ca9140beba88ea256fdccdcb78c6ea0c92de26b7f5ee1cd22371126b33db125336c9f42b5f75d69e2ff0345e498b6026583da2edc4deee2f9ea92cda4c45ab40da58e83290224ef99d7442aecc686db34d030","asset_commit":"0a0ae867ce271250ad57f2c98d6e16f2393882a0bc0aa4ca9bb6e5c13cbcfaa212","surjection_proof":""}]
`)
	kernelBytes := []byte(`
[{"features":"Coinbase","fee":"0","lock_height":"0","excess":"080eaf25a928759fc3541ead4caa2b94df957328e20e0cc580c3d421cf87999a62","excess_sig":""},{"features":"Coinbase","fee":"0","lock_height":"0","excess":"082b4b3fc30fbfe29eff86bd0b47ca873c25b0eaae60a92fbff4a92daf6a55e6be","excess_sig":""},{"features":"Plain","fee":"0","lock_height":"0","excess":"09383fb8bed2c4d5e85e78f5c865bc4446115fad50445ff87cebd5a153597c6fca","excess_sig":"ea1d420ceedf7589feb7e685afcb89b6c7498f6ae49d8bbbea046b410e9fed0f6ced8b9933396f6af4d6f5e8ca306c0c379f2d996d4266b1caefa02e3114b476"},{"features":"Coinbase","fee":"0","lock_height":"0","excess":"093ab6fc5ff534c0cf771c6d26488987453e4096499081759bf8cdac9af5f8f830","excess_sig":""}]
`)
	assetBytes := []byte(`
{"apple":3,"dollar":10,"orange":5}
`)

	var outputs []Output

	err := json.Unmarshal(outputBytes, &outputs)
	assert.NoError(t, err)

	var kernels []TxKernel

	err = json.Unmarshal(kernelBytes, &kernels)
	assert.NoError(t, err)

	var assets map[string]uint64

	err = json.Unmarshal(assetBytes, &assets)
	assert.NoError(t, err)

	msg, err := ValidateState(outputs, kernels, assets)
	assert.NoError(t, err)
	fmt.Println(msg)
}
